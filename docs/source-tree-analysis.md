# Source Tree Analysis

## Project Structure Overview

This is a **monorepo** project using Turborepo with 4 main parts organized into `apps/` and `packages/`.

```
planner/
â”œâ”€â”€ apps/                    # Application packages
â”‚   â””â”€â”€ web/                # Full-stack Next.js application
â””â”€â”€ packages/               # Shared library packages
    â”œâ”€â”€ api/               # RPC API layer
    â”œâ”€â”€ auth/              # Authentication logic
    â””â”€â”€ db/                # Database schemas and ORM
```

---

## Complete Annotated Tree

```
planner/ (root)
â”‚
â”œâ”€â”€ .bmad/                          # BMAD workflow system
â”‚   â”œâ”€â”€ core/                      # Core BMAD tasks and workflows
â”‚   â”‚   â”œâ”€â”€ tasks/                # Workflow execution tasks
â”‚   â”‚   â”œâ”€â”€ tools/                # BMAD utility tools
â”‚   â”‚   â”œâ”€â”€ workflows/            # Core workflow definitions
â”‚   â”‚   â””â”€â”€ agents/               # BMAD agents
â”‚   â”œâ”€â”€ bmm/                      # BMM methodology workflows
â”‚   â”‚   â”œâ”€â”€ tasks/                # BMM-specific tasks
â”‚   â”‚   â”œâ”€â”€ workflows/            # BMM workflow definitions
â”‚   â”‚   â”‚   â””â”€â”€ document-project/ # Project documentation workflow
â”‚   â”‚   â”œâ”€â”€ agents/               # BMM agents (pm, dev, architect, etc.)
â”‚   â”‚   â”œâ”€â”€ docs/                 # BMM documentation
â”‚   â”‚   â”œâ”€â”€ testarch/             # Test architecture
â”‚   â”‚   â””â”€â”€ teams/                # Team definitions
â”‚   â”œâ”€â”€ _cfg/                     # BMAD configuration
â”‚   â”‚   â”œâ”€â”€ agents/               # Agent configurations
â”‚   â”‚   â””â”€â”€ ides/                 # IDE integrations
â”‚   â””â”€â”€ docs/                     # BMAD documentation
â”‚
â”œâ”€â”€ .claude/                        # Claude Code configuration
â”‚   â”œâ”€â”€ agents/                   # Custom Claude agents
â”‚   â”‚   â”œâ”€â”€ bmad-analysis/       # Analysis agent
â”‚   â”‚   â”œâ”€â”€ bmad-research/       # Research agent
â”‚   â”‚   â”œâ”€â”€ bmad-review/         # Review agent
â”‚   â”‚   â””â”€â”€ bmad-planning/       # Planning agent
â”‚   â”œâ”€â”€ commands/                 # Custom slash commands
â”‚   â”‚   â””â”€â”€ bmad/                # BMAD-specific commands
â”‚   â””â”€â”€ CLAUDE.md                # Code standards (Ultracite)
â”‚
â”œâ”€â”€ .windsurf/                      # Windsurf IDE configuration
â”‚   â”œâ”€â”€ workflows/                # Windsurf workflows
â”‚   â”‚   â””â”€â”€ bmad/                # BMAD workflow integration
â”‚   â””â”€â”€ rules/                    # Windsurf rules
â”‚
â”œâ”€â”€ .bmad-ephemeral/                # Temporary BMAD files (gitignored)
â”‚
â”œâ”€â”€ docs/                           # ðŸ“š Project Documentation (OUTPUT FOLDER)
â”‚   â”œâ”€â”€ technical/                # Technical documentation
â”‚   â”œâ”€â”€ bmm-workflow-status.yaml  # BMM workflow tracking
â”‚   â”œâ”€â”€ project-scan-report.json  # Scan state file
â”‚   â”œâ”€â”€ technology-stack.md       # Tech stack documentation
â”‚   â”œâ”€â”€ api-contracts.md          # API endpoint documentation
â”‚   â”œâ”€â”€ data-models.md            # Database schema documentation
â”‚   â”œâ”€â”€ component-inventory.md    # UI component catalog
â”‚   â””â”€â”€ [generated files]         # Additional docs generated by this workflow
â”‚
â”œâ”€â”€ apps/                           # ðŸŽ¯ APPLICATION LAYER
â”‚   â””â”€â”€ web/                      # Part: web (Next.js full-stack app)
â”‚       â”œâ”€â”€ src/
â”‚       â”‚   â”œâ”€â”€ app/              # Next.js App Router
â”‚       â”‚   â”‚   â”œâ”€â”€ page.tsx     # Home page (entry point)
â”‚       â”‚   â”‚   â”œâ”€â”€ layout.tsx   # Root layout with providers
â”‚       â”‚   â”‚   â”œâ”€â”€ dashboard/   # Dashboard pages
â”‚       â”‚   â”‚   â”‚   â”œâ”€â”€ page.tsx
â”‚       â”‚   â”‚   â”‚   â””â”€â”€ dashboard.tsx
â”‚       â”‚   â”‚   â”œâ”€â”€ login/       # Login page
â”‚       â”‚   â”‚   â”‚   â””â”€â”€ page.tsx
â”‚       â”‚   â”‚   â””â”€â”€ api/         # Next.js API routes
â”‚       â”‚   â”‚       â”œâ”€â”€ auth/    # Better-Auth endpoints
â”‚       â”‚   â”‚       â”‚   â””â”€â”€ [...all]/
â”‚       â”‚   â”‚       â”‚       â””â”€â”€ route.ts # Auth handler
â”‚       â”‚   â”‚       â””â”€â”€ rpc/     # ORPC endpoints
â”‚       â”‚   â”‚           â””â”€â”€ [[...rest]]/
â”‚       â”‚   â”‚               â””â”€â”€ route.ts # RPC/OpenAPI handler
â”‚       â”‚   â”‚
â”‚       â”‚   â”œâ”€â”€ components/       # React components
â”‚       â”‚   â”‚   â”œâ”€â”€ ui/          # shadcn/ui components
â”‚       â”‚   â”‚   â”‚   â”œâ”€â”€ button.tsx
â”‚       â”‚   â”‚   â”‚   â”œâ”€â”€ card.tsx
â”‚       â”‚   â”‚   â”‚   â”œâ”€â”€ input.tsx
â”‚       â”‚   â”‚   â”‚   â”œâ”€â”€ label.tsx
â”‚       â”‚   â”‚   â”‚   â”œâ”€â”€ checkbox.tsx
â”‚       â”‚   â”‚   â”‚   â”œâ”€â”€ dropdown-menu.tsx
â”‚       â”‚   â”‚   â”‚   â”œâ”€â”€ skeleton.tsx
â”‚       â”‚   â”‚   â”‚   â””â”€â”€ sonner.tsx
â”‚       â”‚   â”‚   â”œâ”€â”€ header.tsx   # App header
â”‚       â”‚   â”‚   â”œâ”€â”€ user-menu.tsx # User dropdown
â”‚       â”‚   â”‚   â”œâ”€â”€ mode-toggle.tsx # Theme switcher
â”‚       â”‚   â”‚   â”œâ”€â”€ sign-in-form.tsx # Sign-in form
â”‚       â”‚   â”‚   â”œâ”€â”€ sign-up-form.tsx # Registration form
â”‚       â”‚   â”‚   â”œâ”€â”€ loader.tsx   # Loading indicator
â”‚       â”‚   â”‚   â”œâ”€â”€ theme-provider.tsx # Theme context
â”‚       â”‚   â”‚   â””â”€â”€ providers.tsx # Combined providers
â”‚       â”‚   â”‚
â”‚       â”‚   â”œâ”€â”€ lib/              # Utility libraries
â”‚       â”‚   â”‚   â””â”€â”€ auth-client.ts # Auth client setup
â”‚       â”‚   â”‚
â”‚       â”‚   â”œâ”€â”€ utils/            # Utility functions
â”‚       â”‚   â”‚   â””â”€â”€ orpc.ts      # ORPC client setup
â”‚       â”‚   â”‚
â”‚       â”‚   â””â”€â”€ index.css         # Global styles (Tailwind)
â”‚       â”‚
â”‚       â”œâ”€â”€ public/               # Static assets
â”‚       â”œâ”€â”€ .env                  # Environment variables (gitignored)
â”‚       â”œâ”€â”€ .env.example          # Example environment file
â”‚       â”œâ”€â”€ next.config.ts        # Next.js configuration
â”‚       â”œâ”€â”€ components.json       # shadcn/ui configuration
â”‚       â”œâ”€â”€ postcss.config.mjs    # PostCSS configuration
â”‚       â”œâ”€â”€ tsconfig.json         # TypeScript configuration
â”‚       â””â”€â”€ package.json          # Web app dependencies
â”‚
â”œâ”€â”€ packages/                       # ðŸ“¦ SHARED PACKAGES
â”‚   â”‚
â”‚   â”œâ”€â”€ api/                      # Part: api (RPC layer)
â”‚   â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”‚   â”œâ”€â”€ index.ts         # ORPC server setup
â”‚   â”‚   â”‚   â”œâ”€â”€ context.ts       # Request context creation
â”‚   â”‚   â”‚   â””â”€â”€ routers/         # RPC routers
â”‚   â”‚   â”‚       â””â”€â”€ index.ts     # AppRouter with procedures
â”‚   â”‚   â”œâ”€â”€ dist/                # Build output (tsdown)
â”‚   â”‚   â”œâ”€â”€ tsconfig.json        # TypeScript configuration
â”‚   â”‚   â”œâ”€â”€ tsdown.config.ts     # Build configuration
â”‚   â”‚   â””â”€â”€ package.json         # API package dependencies
â”‚   â”‚
â”‚   â”œâ”€â”€ db/                       # Part: db (Data layer)
â”‚   â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”‚   â”œâ”€â”€ index.ts         # Drizzle database connection
â”‚   â”‚   â”‚   â”œâ”€â”€ schema/          # Database schemas
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ auth.ts     # Auth tables (user, session, account, verification)
â”‚   â”‚   â”‚   â””â”€â”€ migrations/      # SQL migration files (generated)
â”‚   â”‚   â”œâ”€â”€ dist/                # Build output
â”‚   â”‚   â”œâ”€â”€ docker-compose.yml   # Local PostgreSQL setup
â”‚   â”‚   â”œâ”€â”€ drizzle.config.ts    # Drizzle Kit configuration
â”‚   â”‚   â”œâ”€â”€ tsconfig.json        # TypeScript configuration
â”‚   â”‚   â”œâ”€â”€ tsdown.config.ts     # Build configuration
â”‚   â”‚   â””â”€â”€ package.json         # DB package dependencies
â”‚   â”‚
â”‚   â””â”€â”€ auth/                     # Part: auth (Authentication)
â”‚       â”œâ”€â”€ src/
â”‚       â”‚   â””â”€â”€ index.ts         # Better-Auth configuration
â”‚       â”œâ”€â”€ dist/                # Build output
â”‚       â”œâ”€â”€ tsconfig.json        # TypeScript configuration
â”‚       â”œâ”€â”€ tsdown.config.ts     # Build configuration
â”‚       â””â”€â”€ package.json         # Auth package dependencies
â”‚
â”œâ”€â”€ node_modules/                   # Root dependencies (gitignored)
â”‚
â”œâ”€â”€ .git/                          # Git repository
â”œâ”€â”€ .gitignore                     # Git ignore patterns
â”œâ”€â”€ .vscode/                       # VS Code settings
â”‚
â”œâ”€â”€ package.json                   # Root package.json (workspaces)
â”œâ”€â”€ bun.lock                       # Bun lockfile
â”œâ”€â”€ bunfig.toml                    # Bun configuration
â”œâ”€â”€ turbo.json                     # Turborepo configuration
â”œâ”€â”€ tsconfig.base.json             # Shared TypeScript config
â”œâ”€â”€ tsconfig.json                  # Root TypeScript config
â”œâ”€â”€ biome.json                     # Biome/Ultracite config
â”œâ”€â”€ bts.jsonc                      # Better-T-Stack configuration
â””â”€â”€ README.md                      # Project README
```

---

## Critical Directories Explained

### `apps/web/src/app/` - Next.js App Router
**Purpose:** Main application routes and pages
**Entry Point:** `app/page.tsx`
**Pattern:** File-system based routing
**Key Files:**
- `layout.tsx` - Root layout with providers
- `page.tsx` - Home page
- `app/api/` - API routes (auth, rpc)

### `apps/web/src/components/` - React Components
**Purpose:** Reusable UI components
**Pattern:** Composition-based components
**Subfolders:**
- `ui/` - shadcn/ui base components
- Root level - Application-specific components

### `packages/api/src/routers/` - RPC Endpoints
**Purpose:** Type-safe RPC procedures
**Entry Point:** `routers/index.ts` exports `appRouter`
**Pattern:** Procedure-based API definition
**Integration:** Mounted at `/api/rpc` in web app

### `packages/db/src/schema/` - Database Schemas
**Purpose:** Drizzle ORM table definitions
**Entry Point:** Individual schema files (e.g., `auth.ts`)
**Pattern:** Schema-first database design
**Tables:** user, session, account, verification

### `packages/db/src/migrations/` - Database Migrations
**Purpose:** SQL migration files
**Generated By:** Drizzle Kit (`bun run db:generate`)
**Applied Via:** `bun run db:migrate` (prod) or `bun run db:push` (dev)

---

## Integration Points

### Web â†” API
**Connection:** ORPC client in `apps/web/src/utils/orpc.ts`
**Protocol:** Type-safe RPC over HTTP
**Endpoint:** `/api/rpc`

### API â†” DB
**Connection:** Database import in `packages/api`
**Usage:** Procedures import `db` from `@planner/db`
**Pattern:** Direct ORM access

### Web â†” Auth
**Connection:** Auth client in `apps/web/src/lib/auth-client.ts`
**Protocol:** Better-Auth client methods
**Endpoint:** `/api/auth/[...all]`

### API â†” Auth
**Connection:** Session extraction in `packages/api/src/context.ts`
**Pattern:** Auth injected into ORPC context
**Usage:** Available in all procedures via `context.session`

### Auth â†” DB
**Connection:** Auth imports database schemas
**Usage:** User and session management
**Tables:** Uses `user`, `session`, `account`, `verification` tables

---

## Build Artifacts (Gitignored)

```
dist/                  # TypeScript build outputs
node_modules/          # Package dependencies
.next/                 # Next.js build cache
.turbo/                # Turborepo cache
.bmad-ephemeral/       # BMAD temporary files
```

---

## Configuration Files

| File | Purpose |
|------|---------|
| `turbo.json` | Turborepo task orchestration |
| `biome.json` | Code quality (Ultracite/Biome) |
| `tsconfig.base.json` | Shared TypeScript config |
| `package.json` | Bun workspaces configuration |
| `bunfig.toml` | Bun package manager settings |
| `drizzle.config.ts` | Database ORM configuration |
| `next.config.ts` | Next.js framework settings |
| `components.json` | shadcn/ui component config |

---

## Entry Points by Part

### Web Application
- **Main Entry:** `apps/web/src/app/page.tsx`
- **Layout:** `apps/web/src/app/layout.tsx`
- **Server Entry:** `apps/web/src/app/api/rpc/[[...rest]]/route.ts`

### API Layer
- **Router:** `packages/api/src/routers/index.ts`
- **Context:** `packages/api/src/context.ts`

### Database
- **Connection:** `packages/db/src/index.ts`
- **Schemas:** `packages/db/src/schema/`

### Authentication
- **Config:** `packages/auth/src/index.ts`

---

## Development Workflow Paths

### Running the App
1. **Entry:** `bun run dev` (root)
2. **Turborepo:** Reads `turbo.json`, starts `web:dev`
3. **Next.js:** Starts dev server on port 3001
4. **Hot Reload:** Watches all workspace packages

### Building
1. **Entry:** `bun run build` (root)
2. **Turborepo:** Builds packages in dependency order
3. **Order:** `db` â†’ `auth` â†’ `api` â†’ `web`
4. **Output:** `dist/` folders in each package

### Database Operations
1. **Schema Change:** Edit `packages/db/src/schema/*.ts`
2. **Generate Migration:** `bun run db:generate`
3. **Apply:** `bun run db:push` (dev) or `bun run db:migrate` (prod)

---

## Folder Naming Conventions

- **Lowercase with hyphens:** `sign-in-form.tsx`
- **Component files:** PascalCase export, kebab-case filename
- **Folders:** Lowercase, descriptive
- **Special Next.js:**
  - `page.tsx` - Route pages
  - `layout.tsx` - Layouts
  - `route.ts` - API routes
  - `[param]` - Dynamic routes
  - `[[...rest]]` - Optional catch-all routes

---

## Multi-Part Repository Benefits

**Separation of Concerns:**
- `web` - Frontend UI and UX
- `api` - Business logic and procedures
- `db` - Data persistence and schemas
- `auth` - Authentication and authorization

**Reusability:**
- Packages can be imported by multiple apps
- Type definitions shared across boundaries
- Centralized configuration

**Independent Development:**
- Each part can be developed separately
- Clear ownership boundaries
- Easier to scale team

**Type Safety:**
- End-to-end types from DB â†’ API â†’ Frontend
- Compile-time validation
- Auto-completion in IDE

---

## Future Structure Extensions

As the project grows, expect:

### New Apps
- `apps/admin/` - Admin dashboard
- `apps/mobile/` - React Native app
- `apps/native/` - Tauri desktop app

### New Packages
- `packages/types/` - Shared TypeScript types
- `packages/ui/` - Shared component library
- `packages/utils/` - Shared utility functions
- `packages/config/` - Shared configuration
- `packages/validators/` - Shared Zod schemas

### Additional Schemas
- `packages/db/src/schema/core.ts` - Business entities
- `packages/db/src/schema/audit.ts` - Audit logs
- `packages/db/src/schema/settings.ts` - User settings
